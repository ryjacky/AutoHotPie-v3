<div class="body center-horizontal">

  <div class="two-side">
    <div>
      <h4>{{ profileService.name }}</h4>
    </div>
    <div>
      <button nbButton status="primary" style="align-self: center" [nbPopover]="addPieMenuPopover"
              [nbPopoverPlacement]="nbPosition.BOTTOM">
        <nb-icon icon="plus-outline"/>
        {{ 'PAGES.HOME.ADD_PIE_MENU' | translate }}
      </button>
      <button nbButton status="primary" (click)="profSettingsRevealed = !profSettingsRevealed">
        <nb-icon icon="settings-2-outline"/>
      </button>
    </div>
  </div>

  <!-- The panel that lists all pie menus within the current profile -->
  <div [style.display]="!profSettingsRevealed ? 'flex' : 'none'" class="center-horizontal">
    <app-pie-menu-list style="max-height: 65vh; overflow-y: scroll;"/>

  </div>

  <div [style]="{'display': profSettingsRevealed ? 'unset' : 'none'}">
    <h5 style="margin: 0;">{{"PAGES.HOME.PROF_SETTINGS" | translate}}</h5>

    <div
      style="display: flex; flex-direction: row; align-content: center; justify-content: space-between; align-items: center;">
      No settings yet :)
<!--      <div>-->
<!--        <p style="font-size: large; margin: 0.5em 0;">{{ "PAGES.HOME.enabled" | translate}}</p>-->
<!--        <p>{{ "PAGES.HOME.enabled_DESC" | translate}}</p>-->
<!--      </div>-->
<!--      <nb-toggle [checked]="profileService.enabled" (checkedChange)="profileService.toggle()"></nb-toggle>-->
    </div>

    <!--  The profile setting section that shows all binaries added to the current profile  -->
    <!--  Not showing this section for the default profile since it's globally available  -->
    <nb-card
      *ngIf="profileService.id !== 1;"
      style="background-color: transparent; border: 2px solid var(--actions-disabled-text-color);"
    >
      <nb-card-header style="padding: 10px 20px;">{{ "PAGES.PROFILE.SETTINGS.EXE_VER" | translate }}</nb-card-header>
      <nb-list>
        <nb-list-item *ngFor="let exe of profileService.exes; let i = index"
                      [style.background]="i % 2 !== 0 ? 'var(--border-basic-color-2)' : 'var(--accordion-header-border-color)'"
                      style="padding: 5px 20px; display: flex; flex-direction: row; place-content: center; align-items: center; height: 100%; justify-content: space-between;">
          <div style="text-overflow: ellipsis; max-width: 90%; overflow: hidden">
            {{ exe }}
          </div>
          <button nbButton *ngIf="i !== 0" status="danger" size="tiny" (click)="removeExecutableVersion(exe)">
            <nb-icon icon="minus-outline"></nb-icon>
          </button>
        </nb-list-item>

        <nb-list-item style="padding: 10px">
          <button nbButton size="tiny" fullWidth
                  (click)="addMissingExeClicked()">{{ "PAGES.PROFILE.SETTINGS.ADD_MISSING_EXE" | translate }}</button>
        </nb-list-item>
      </nb-list>
    </nb-card>


  </div>

</div>

<ng-template #addPieMenuPopover>
  <div
    style="display: flex; flex-direction: column; flex-wrap: nowrap; align-content: center; justify-content: center; align-items: stretch; padding: 10px;">
    <button nbButton size="small" ghost style="border: solid; margin-bottom: 5px" (click)="profileService.createAndAddPieMenu()">
      <nb-icon icon="plus-outline"/>
      {{ 'PAGES.HOME.NEW_PIE_MENU' | translate }}
    </button>
    <button nbButton size="small" ghost style="border: solid; " (click)="openPieMenuSelector(pieMenuSelectorDialog)">
      <nb-icon icon="download-outline"/>
      {{ 'PAGES.HOME.ADD_FROM_EXISTING' | translate }}
    </button>
  </div>
</ng-template>

<ng-template #pieMenuSelectorDialog let-data let-ref="dialogRef">
  <nb-card>
    <nb-card-header style="
      padding: 0.7em 1.5em;
      display: flex;
      justify-content: space-between;
      align-items: center;"
    >
      Available Pie Menus
      <button nbButton ghost size="small"
              (click)="ref.close()">{{ "PAGES.PIE_MENU_SELECTOR.CANCEL" | translate }}</button>
    </nb-card-header>
    <nb-card-body
      style="width: 50vw; display: flex; flex-wrap: wrap; flex-direction: row; align-content: flex-start; justify-content: flex-start; align-items: flex-start;">
      <button nbButton *ngFor="let pieMenu of data | async" size="small"
              ghost
              (click)="profileService.addPieMenu(pieMenu); ref.close()"
              style="border: solid; margin-right: 10px; margin-bottom: 10px">{{pieMenu.name}}</button>
    </nb-card-body>
  </nb-card>
</ng-template>
